<div class="card p-3">
    <div class="row form-group" [formGroup]="formGroup">
        <div class="col-12 d-flex level-bar-numbers mb-1">
            <span class="remove-exp spacer" *ngIf="showRemoveExp()"></span>
            <div class="level-slots-labels d-flex flex-grow-1">
                <span class="level-icon">
                    <img src="/assets/art/Public/Public/Icons/Level_L1.png" alt="Level 1">
                </span>
                <span></span>
                <span class="level-icon">
                    <img src="/assets/art/Public/Public/Icons/Level_L2.png" alt="Level 2">
                </span>
                <span></span>
                <span class="level-icon level-3">
                    <img src="/assets/art/Public/Public/Icons/Level_L3.png" alt="Level 3">
                </span>
            </div>
        </div>
        <div class="col-12 d-flex level-bar mb-2">
            <span (click)="setExp(0)" class="remove-exp" *ngIf="showRemoveExp()">x</span>
            <span (click)="setExp(1)" [class.selected]="getIsSelected(1)"></span>
            <span (click)="setExp(2)" [class.selected]="getIsSelected(2)"></span>
            <span (click)="setExp(3)" [class.selected]="getIsSelected(3)"></span>
            <span (click)="setExp(4)" [class.selected]="getIsSelected(4)"></span>
            <span (click)="setExp(5)" [class.selected]="getIsSelected(5)"></span>
        </div>
        <div class="col-12 mb-2">
            <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
                (click)="openSelectionDialog('pet')">
                <img *ngIf="petImageSrc" [src]="petImageSrc" class="btn-icon me-2" width="24" height="24">
                <span class="btn-text">{{ formGroup.get('name').value || 'Select Pet' }}</span>
                <i class="bi bi-chevron-down ms-auto"></i>
            </button>
        </div>
        <div class="col-12 mb-2" *ngIf="pet?.name == 'Tuna'">
            <label for="timesHurt">Times Hurt</label>
            <input class="form-control" formControlName="timesHurt" type="number" min="0" max="99">
        </div>
        <div class="col-12 mb-2" *ngIf="pet?.name == 'Beluga Whale'">
            <label class="swallowed-label" for="belugaSwallowedPet">Swallowed Pet</label>
            <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
                (click)="openSelectionDialog('swallowed-pet')">
                <img *ngIf="getPetImagePath(formGroup.get('belugaSwallowedPet').value)"
                    [src]="getPetImagePath(formGroup.get('belugaSwallowedPet').value)" class="btn-icon me-2" width="24"
                    height="24">
                <span class="btn-text">{{ formGroup.get('belugaSwallowedPet').value || 'Select Pet' }}</span>
                <i class="bi bi-chevron-down ms-auto"></i>
            </button>
        </div>
        <div class="col-12 mb-2" *ngIf="pet?.name == 'Abomination'">
            <div *ngFor="let a of [].constructor(pet.level); index as i">
                <label class="swallowed-label" for="abominationSwallowedPet{{i + 1}}">Swallowed Pet</label>
                <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
                    (click)="openSelectionDialog('swallowed-pet', i+1, 'abomination')">
                    <img *ngIf="getPetImagePath(formGroup.get('abominationSwallowedPet' + (i+1)).value)"
                        [src]="getPetImagePath(formGroup.get('abominationSwallowedPet' + (i+1)).value)"
                        class="btn-icon me-2" width="24" height="24">
                    <span class="btn-text">{{ formGroup.get('abominationSwallowedPet' + (i+1)).value || 'Select Pet'
                        }}</span>
                    <i class="bi bi-chevron-down ms-auto"></i>
                </button>
                <ng-container *ngIf="formGroup.get('abominationSwallowedPet' + (i+1)).value === 'Beluga Whale'">
                    <label class="swallowed-label mt-1" for="abominationSwallowedPet{{i + 1}}BelugaSwallowedPet">Beluga Swallowed Pet</label>
                    <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
                        (click)="openSelectionDialog('swallowed-pet', i+1, 'abomination-beluga')">
                        <img *ngIf="getPetImagePath(formGroup.get('abominationSwallowedPet' + (i+1) + 'BelugaSwallowedPet').value)"
                            [src]="getPetImagePath(formGroup.get('abominationSwallowedPet' + (i+1) + 'BelugaSwallowedPet').value)"
                            class="btn-icon me-2" width="24" height="24">
                        <span class="btn-text">{{ formGroup.get('abominationSwallowedPet' + (i+1) + 'BelugaSwallowedPet').value || 'Select Pet' }}</span>
                        <i class="bi bi-chevron-down ms-auto"></i>
                    </button>
                </ng-container>
                <ng-container *ngIf="showSwallowedLevels">
                    <label class="swallowed-label mt-1" for="abominationSwallowedPet{{i + 1}}Level">Swallowed
                        Level</label>
                    <select class="form-control" formControlName="abominationSwallowedPet{{i + 1}}Level">
                        <option [ngValue]="1">1</option>
                        <option [ngValue]="2">2</option>
                        <option [ngValue]="3">3</option>
                    </select>
                </ng-container>
                <ng-container *ngIf="shouldShowAbominationSwallowTimesHurt(i)">
                    <label class="swallowed-label mt-1" for="abominationSwallowedPet{{i + 1}}TimesHurt">Times
                        Hurt</label>
                    <input class="form-control" formControlName="abominationSwallowedPet{{i + 1}}TimesHurt"
                        type="number" min="0" max="99">
                </ng-container>
            </div>
        </div>
        <div class="col-12 mb-2" *ngIf="formGroup.get('name').value == 'Sarcastic Fringehead'">
            <label class="swallowed-label" for="sarcasticFringeheadSwallowedPet">Swallowed Pet</label>
            <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
                (click)="openSelectionDialog('swallowed-pet')">
                <img *ngIf="getPetImagePath(formGroup.get('sarcasticFringeheadSwallowedPet').value)"
                    [src]="getPetImagePath(formGroup.get('sarcasticFringeheadSwallowedPet').value)"
                    class="btn-icon me-2" width="24" height="24">
                <span class="btn-text">{{ formGroup.get('sarcasticFringeheadSwallowedPet').value || 'Select Pet'
                    }}</span>
                <i class="bi bi-chevron-down ms-auto"></i>
            </button>
        </div>
        <div class="col-12 mb-2" *ngIf="shouldShowFriendsDiedInput()">
            <label class="swallowed-label" for="friendsDiedBeforeBattle">Friends Fainted in Shop</label>
            <input class="form-control" type="number" min="0" max="5" formControlName="friendsDiedBeforeBattle">
        </div>
        <div class="col-12 mb-2">
            <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
                (click)="openSelectionDialog('equipment')">
                <img *ngIf="equipmentImageSrc" [src]="equipmentImageSrc" class="btn-icon me-2" width="24" height="24">
                <img *ngIf="!equipmentImageSrc && ailmentImageSrc" [src]="ailmentImageSrc" class="btn-icon me-2"
                    width="24" height="24">
                <span class="btn-text">{{ formGroup.get('equipment').value?.name || 'Select Equipment' }}</span>
                <i class="bi bi-chevron-down ms-auto"></i>
            </button>
        </div>
        <div class="col-6 mb-2" *ngIf="allowEquipmentUseOverrides && equipmentUsesAvailable">
            <label [for]="equipmentUsesInputId">Uses</label>
            <input class="form-control" type="number" min="1" max="99" [id]="equipmentUsesInputId"
                formControlName="equipmentUses">
        </div>
        <div class="col-12 pet-art" *ngIf="petImageSrc && !petImageBroken" [class.equipment-left]="!flipImage"
            [class.equipment-right]="flipImage">
            <img [src]="petImageSrc" [alt]="formGroup.get('name').value || 'Pet'" [class.flipped]="flipImage"
                (error)="petImageBroken = true">
            <div class="equipment-art" *ngIf="(equipmentImageSrc || ailmentImageSrc) && !equipmentImageBroken">
                <img *ngIf="equipmentImageSrc" [src]="equipmentImageSrc"
                    [alt]="formGroup.get('equipment').value?.name || 'Equipment'" (error)="equipmentImageBroken = true">
                <img *ngIf="!equipmentImageSrc && ailmentImageSrc" [src]="ailmentImageSrc"
                    [alt]="formGroup.get('equipment').value?.name || 'Ailment'" (error)="equipmentImageBroken = true">
            </div>
            <div class="swallowed-art" *ngIf="swallowedPetImageSrc">
                <img [src]="swallowedPetImageSrc" alt="Swallowed Pet">
            </div>
            <div class="swallowed-art swallowed-stack" *ngIf="abominationSwallowedPetImages.length">
                <img *ngFor="let image of abominationSwallowedPetImages" [src]="image" alt="Swallowed Pet">
            </div>
        </div>
        <ng-container *ngIf="mana || triggersConsumed">
            <div class="col-12" *ngIf="mana && !triggersConsumed">
                <div class="stat-tile stat-mana">
                    <input class="form-control stat-input select-mana" formControlName="mana" type="number" min="0"
                        max="50" placeholder="Mana">
                </div>
            </div>
            <div class="col-12" *ngIf="!mana && triggersConsumed">
                <input class="form-control select-triggers-consumed single-stat-input"
                    formControlName="triggersConsumed" type="number" min="0" max="10" placeholder="Triggers Consumed">
            </div>
            <ng-container *ngIf="mana && triggersConsumed">
                <div class="col-6">
                    <div class="stat-tile stat-mana">
                        <input class="form-control stat-input select-mana" formControlName="mana" type="number" min="0"
                            max="50" placeholder="Mana">
                    </div>
                </div>
                <div class="col-6">
                    <input class="form-control select-triggers-consumed" formControlName="triggersConsumed"
                        type="number" min="0" max="10" placeholder="Triggers Consumed">
                </div>
            </ng-container>
        </ng-container>
        <div class="col-6">
            <div class="stat-tile stat-attack">
                <input class="form-control stat-input select-attack" formControlName="attack" type="number" min="1"
                    [max]="attackHealthMax">
            </div>
        </div>
        <div class="col-6">
            <div class="stat-tile stat-health">
                <input class="form-control stat-input select-health" formControlName="health" type="number" min="1"
                    [max]="attackHealthMax">
            </div>
        </div>
    </div>
</div>

<app-item-selection-dialog *ngIf="showSelectionDialog" [type]="selectionType" [showAllPets]="allPets"
    [currentPack]="player?.pack" (select)="onItemSelected($event)" (close)="showSelectionDialog = false">
</app-item-selection-dialog>