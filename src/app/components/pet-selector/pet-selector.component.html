<div class="card p-2">
  <form class="row form-group g-0" [formGroup]="formGroup">

    <!-- Level Bar -->
    <app-pet-level-selector [formGroup]="formGroup"></app-pet-level-selector>

    <!-- Pet Name Selector -->
    <div class="col-12 mb-2">
      <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
        (click)="openSelectionDialog('pet')">
        <img *ngIf="petImageSrc" [ngSrc]="petImageSrc" class="btn-icon me-2" width="24" height="24" loading="lazy"
          decoding="async" />
        <span class="btn-text">{{
          formGroup.get("name").value || "Select Pet"
          }}</span>
        <i class="fas fa-chevron-down ms-auto"></i>
      </button>
    </div>

    <!-- Swallowed Pet Settings -->
    <app-swallowed-pet-selector [formGroup]="formGroup" [pet]="pet" [showSwallowedLevels]="showSwallowedLevels"
      (onOpenSelection)="openSelectionDialog($event.type, $event.index, $event.target, $event.parentIndex)">
    </app-swallowed-pet-selector>

    <!-- Equipment Selector -->
    <app-pet-equipment-selector [formGroup]="formGroup" [equipmentImageSrc]="equipmentImageSrc"
      [ailmentImageSrc]="ailmentImageSrc" [allowEquipmentUseOverrides]="allowEquipmentUseOverrides"
      [equipmentUsesAvailable]="equipmentUsesAvailable" [equipmentUsesInputId]="equipmentUsesInputId"
      (onOpenSelection)="openSelectionDialog('equipment')">
    </app-pet-equipment-selector>

    <!-- Pet Art -->
    <div class="col-12 pet-art mb-2" *ngIf="petImageSrc && !petImageBroken" [class.equipment-left]="!flipImage"
      [class.equipment-right]="flipImage">
      <img [ngSrc]="petImageSrc" width="72" height="72" [alt]="formGroup.get('name').value || 'Pet'"
        [class.flipped]="flipImage" loading="lazy" decoding="async" (error)="petImageBroken = true" />
      <div class="equipment-art" *ngIf="(equipmentImageSrc || ailmentImageSrc) && !equipmentImageBroken">
        <img *ngIf="equipmentImageSrc" [ngSrc]="equipmentImageSrc" width="32" height="32" loading="lazy"
          decoding="async" [alt]="formGroup.get('equipment').value || 'Equipment'"
          (error)="equipmentImageBroken = true" />
        <img *ngIf="!equipmentImageSrc && ailmentImageSrc" [ngSrc]="ailmentImageSrc" width="32" height="32"
          loading="lazy" decoding="async" [alt]="formGroup.get('equipment').value || 'Ailment'"
          (error)="equipmentImageBroken = true" />
      </div>
      <div class="swallowed-art" *ngIf="swallowedPetImageSrc">
        <img [ngSrc]="swallowedPetImageSrc" width="32" height="32" loading="lazy" decoding="async"
          alt="Swallowed Pet" />
      </div>
      <div class="swallowed-art swallowed-stack" *ngIf="abominationSwallowedPetImages.length">
        <img *ngFor="
            let image of abominationSwallowedPetImages;
            trackBy: trackByIndex
          " [ngSrc]="image" width="32" height="32" loading="lazy" decoding="async" alt="Swallowed Pet" />
      </div>
    </div>

    <!-- Stats & Mana/Triggers -->
    <app-pet-stats-selector [formGroup]="formGroup" [petName]="pet?.name" [mana]="mana"
      [triggersConsumed]="triggersConsumed" [attackHealthMax]="attackHealthMax">
    </app-pet-stats-selector>

  </form>
</div>

<app-item-selection-dialog *ngIf="showSelectionDialog" [type]="selectionType"
  [showAllPets]="allPets || forceShowAllPets" [currentPack]="player?.pack" (select)="onItemSelected($event)"
  (close)="closeSelectionDialog()">
</app-item-selection-dialog>