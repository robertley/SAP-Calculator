<div class="replay-calc" [formGroup]="formGroup">
  <p class="text-muted">
    Paste a replay JSON (with an Actions array) or a single battle JSON to
    generate a calculator link for a turn. Participation ID lookup uses the
    credentials saved below in local storage and the local replay backend.
  </p>

  <div class="row g-3 mb-3">
    <div class="col-12 col-md-6">
      <label for="sapEmail" class="form-label">SAP Email</label>
      <input
        id="sapEmail"
        type="email"
        class="form-control"
        formControlName="sapEmail"
        placeholder="you@example.com"
      />
    </div>
    <div class="col-12 col-md-6">
      <label for="sapPassword" class="form-label">SAP Password</label>
      <input
        id="sapPassword"
        type="password"
        class="form-control"
        formControlName="sapPassword"
        placeholder="••••••••"
      />
    </div>
  </div>

  <label for="replayJson" class="form-label">Replay or Battle JSON</label>
  <textarea
    id="replayJson"
    class="form-control mb-3"
    rows="6"
    formControlName="replayJson"
  ></textarea>

  <div class="d-flex align-items-end mb-3 flex-wrap gap-3">
    <div>
      <label for="turnNumber" class="form-label">Turn (1-based)</label>
      <input
        id="turnNumber"
        type="number"
        class="form-control"
        min="1"
        formControlName="turn"
      />
    </div>
    <button class="btn btn-primary" (click)="generate()" [disabled]="loading">
      {{ loading ? "Fetching..." : "Generate Link" }}
    </button>
  </div>

  <div *ngIf="errorMessage" class="text-danger mb-2">{{ errorMessage }}</div>

  <div *ngIf="calculatorLink">
    <label for="calcLink" class="form-label">Calculator Link</label>
    <input
      id="calcLink"
      class="form-control mb-3"
      [value]="calculatorLink"
      readonly
    />
    <button class="btn btn-secondary me-2" (click)="copyLink()">
      Copy Link
    </button>
    <a
      class="btn btn-secondary"
      [href]="calculatorLink"
      target="_blank"
      rel="noopener"
      >Open</a
    >
  </div>
</div>
