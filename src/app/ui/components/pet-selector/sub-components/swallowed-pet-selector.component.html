<ng-container [formGroup]="formGroup">
    <!-- Abomination Swallowed Pets -->
    <div class="col-12 mb-2" *ngIf="pet?.name === 'Abomination'">
        <div *ngFor="let a of [].constructor(pet.level); index as i; trackBy: trackByIndex">
            <div class="swallowed-slot mb-2">
                <label class="swallowed-label">{{ getAbilityTitle(i) }}</label>
                <div class="d-flex align-items-center gap-2">
                    <button type="button" class="btn selection-btn flex-grow-1 d-flex align-items-center"
                        (click)="openSelectionDialog('ability', i + 1, 'abomination')">
                        <span class="selection-icon-wrap"
                            *ngIf="getAbilityImagePath(formGroup.get('abominationSwallowedPet' + (i + 1))?.value) as abilityIcon">
                            <img class="selection-icon" [ngSrc]="abilityIcon" width="24" height="24" loading="lazy"
                                decoding="async" alt="Ability" />
                            <span class="selection-level-badge">{{ getAbominationAbilityLevel(i) }}</span>
                        </span>
                        <span class="selection-text">{{ formGroup.get('abominationSwallowedPet' + (i + 1))?.value ||
                            'None' }}</span>
                        <i class="fas fa-chevron-down ms-auto"></i>
                    </button>
                </div>

                <div class="swallowed-nested mt-2 ps-3 border-start" *ngIf="
                    formGroup.get('abominationSwallowedPet' + (i + 1))?.value &&
                    (
                      shouldShowAbominationSwallowTimesHurt(i) ||
                      formGroup.get('abominationSwallowedPet' + (i + 1))?.value === 'Beluga Whale' ||
                      formGroup.get('abominationSwallowedPet' + (i + 1))?.value === 'Sarcastic Fringehead' ||
                      formGroup.get('abominationSwallowedPet' + (i + 1))?.value === 'Parrot'
                    )
                  ">
                    <!-- Times Hurt (Tuna) -->
                    <div class="form-group small-w-input mb-2" *ngIf="shouldShowAbominationSwallowTimesHurt(i)">
                        <label class="swallowed-label-small">Times Hurt</label>
                        <input class="form-control form-control-sm" type="number" min="0" max="99"
                            [formControlName]="'abominationSwallowedPet' + (i + 1) + 'TimesHurt'" />
                    </div>

                    <!-- Beluga inside Abomination -->
                    <div class="nested-selection mb-2"
                        *ngIf="formGroup.get('abominationSwallowedPet' + (i + 1))?.value === 'Beluga Whale'">
                        <label class="swallowed-label-small">Swallowed by Beluga</label>
                        <button type="button" class="btn selection-btn btn-sm w-100 d-flex align-items-center"
                            (click)="openSelectionDialog('swallowed-pet', i + 1, 'abomination-beluga')">
                            <img *ngIf="getAbilityImagePath(formGroup.get('abominationSwallowedPet' + (i + 1) + 'BelugaSwallowedPet')?.value)"
                                class="selection-icon"
                                [ngSrc]="getAbilityImagePath(formGroup.get('abominationSwallowedPet' + (i + 1) + 'BelugaSwallowedPet')?.value)!"
                                width="20" height="20" loading="lazy" decoding="async" alt="Beluga Swallowed Pet" />
                            <span class="selection-text">{{ formGroup.get('abominationSwallowedPet' + (i + 1) +
                                'BelugaSwallowedPet')?.value || 'None' }}</span>
                            <i class="fas fa-chevron-down ms-auto"></i>
                        </button>
                    </div>

                    <!-- Sarcastic Fringehead inside Abomination -->
                    <div class="nested-selection mb-2"
                        *ngIf="formGroup.get('abominationSwallowedPet' + (i + 1))?.value === 'Sarcastic Fringehead'">
                        <label class="swallowed-label-small">Swallowed by Fringehead</label>
                        <button type="button" class="btn selection-btn btn-sm w-100 d-flex align-items-center"
                            (click)="openSelectionDialog('swallowed-pet', i + 1, 'abomination-sarcastic')">
                            <img *ngIf="getAbilityImagePath(formGroup.get('abominationSwallowedPet' + (i + 1) + 'SarcasticFringeheadSwallowedPet')?.value)"
                                class="selection-icon"
                                [ngSrc]="getAbilityImagePath(formGroup.get('abominationSwallowedPet' + (i + 1) + 'SarcasticFringeheadSwallowedPet')?.value)!"
                                width="20" height="20" loading="lazy" decoding="async" alt="Fringehead Swallowed Pet" />
                            <span class="selection-text">{{ formGroup.get('abominationSwallowedPet' + (i + 1) +
                                'SarcasticFringeheadSwallowedPet')?.value || 'None' }}</span>
                            <i class="fas fa-chevron-down ms-auto"></i>
                        </button>
                    </div>

                    <!-- Parrot inside Abomination -->
                    <div class="nested-selection"
                        *ngIf="formGroup.get('abominationSwallowedPet' + (i + 1))?.value === 'Parrot'">
                        <label class="swallowed-label-small">Parrot Copy</label>
                        <button type="button" class="btn selection-btn btn-sm w-100 d-flex align-items-center"
                            (click)="openSelectionDialog('ability', i + 1, 'abomination-parrot')">
                            <img *ngIf="getAbilityImagePath(formGroup.get('abominationSwallowedPet' + (i + 1) + 'ParrotCopyPet')?.value)"
                                class="selection-icon"
                                [ngSrc]="getAbilityImagePath(formGroup.get('abominationSwallowedPet' + (i + 1) + 'ParrotCopyPet')?.value)!"
                                width="20" height="20" loading="lazy" decoding="async" alt="Parrot Copy Pet" />
                            <span class="selection-text">{{ formGroup.get('abominationSwallowedPet' + (i + 1) +
                                'ParrotCopyPet')?.value || 'None' }}</span>
                            <i class="fas fa-chevron-down ms-auto"></i>
                        </button>

                        <!-- Nested Beluga inside Parrot inside Abomination -->
                        <div class="mt-2 ps-2 border-start"
                            *ngIf="formGroup.get('abominationSwallowedPet' + (i + 1) + 'ParrotCopyPet')?.value === 'Beluga Whale'">
                            <label class="swallowed-label-small">Then Beluga Swallow</label>
                            <button type="button" class="btn selection-btn btn-sm w-100 d-flex align-items-center"
                                (click)="openSelectionDialog('swallowed-pet', i + 1, 'abomination-parrot-beluga')">
                                <img *ngIf="getAbilityImagePath(formGroup.get('abominationSwallowedPet' + (i + 1) + 'ParrotCopyPetBelugaSwallowedPet')?.value)"
                                    class="selection-icon"
                                    [ngSrc]="getAbilityImagePath(formGroup.get('abominationSwallowedPet' + (i + 1) + 'ParrotCopyPetBelugaSwallowedPet')?.value)!"
                                    width="20" height="20" loading="lazy" decoding="async" alt="Nested Beluga" />
                                <span class="selection-text">{{ formGroup.get('abominationSwallowedPet' + (i + 1) +
                                    'ParrotCopyPetBelugaSwallowedPet')?.value || 'None' }}</span>
                                <i class="fas fa-chevron-down ms-auto"></i>
                            </button>
                        </div>

                        <!-- Nested Abomination inside Parrot inside Abomination -->
                        <div class="mt-2 ps-2 border-start"
                            *ngIf="formGroup.get('abominationSwallowedPet' + (i + 1) + 'ParrotCopyPet')?.value === 'Abomination'">
                            <div *ngFor="let b of [].constructor(3); index as j; trackBy: trackByIndex">
                                <label class="swallowed-label-small">{{ getNestedAbominationAbilityTitle(i, j) }}</label>
                                <button type="button"
                                    class="btn selection-btn btn-sm w-100 d-flex align-items-center mb-1"
                                    (click)="openSelectionDialog('ability', i + 1, 'abomination-parrot-abomination', j + 1)">
                                    <span class="selection-icon-wrap"
                                        *ngIf="getAbilityImagePath(formGroup.get('abominationSwallowedPet' + (i + 1) + 'ParrotCopyPetAbominationSwallowedPet' + (j + 1))?.value) as nestedAbilityIcon">
                                        <img class="selection-icon" [ngSrc]="nestedAbilityIcon" width="20" height="20"
                                            loading="lazy" decoding="async" alt="Nested Abom Slot" />
                                        <span class="selection-level-badge">{{ getNestedAbominationAbilityLevel(i, j) }}</span>
                                    </span>
                                    <span class="selection-text">{{ formGroup.get('abominationSwallowedPet' + (i + 1) +
                                        'ParrotCopyPetAbominationSwallowedPet' + (j + 1))?.value || 'None' }}</span>
                                    <i class="fas fa-chevron-down ms-auto"></i>
                                </button>
                                <div class="form-group small-w-input mb-1 ms-2"
                                    *ngIf="shouldShowAbominationParrotCopyAbominationTimesHurt(i + 1, j + 1)">
                                    <label class="swallowed-label-tiny">Times Hurt</label>
                                    <input class="form-control form-control-sm" type="number" min="0" max="99"
                                        [formControlName]="'abominationSwallowedPet' + (i + 1) + 'ParrotCopyPetAbominationSwallowedPet' + (j + 1) + 'TimesHurt'" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Regular Beluga Whale / Parrot / Sarcastic Fringehead in main pet position -->
    <div class="col-12 mb-2">
        <div *ngIf="pet?.name === 'Beluga Whale'">
            <label class="swallowed-label">Swallowed by Beluga</label>
            <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
                (click)="openSelectionDialog('swallowed-pet', undefined, 'pet')">
                <img *ngIf="getAbilityImagePath(formGroup.get('belugaSwallowedPet')?.value)" class="selection-icon"
                    [ngSrc]="getAbilityImagePath(formGroup.get('belugaSwallowedPet')?.value)!" width="24" height="24"
                    loading="lazy" decoding="async" alt="Beluga Swallowed" />
                <span class="selection-text">{{ formGroup.get('belugaSwallowedPet')?.value || 'Select Pet' }}</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </button>
        </div>

        <div *ngIf="pet?.name === 'Parrot'">
            <label class="swallowed-label">Parrot Copy</label>
            <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
                (click)="openSelectionDialog('ability', undefined, 'parrot')">
                <img *ngIf="getAbilityImagePath(formGroup.get('parrotCopyPet')?.value)" class="selection-icon"
                    [ngSrc]="getAbilityImagePath(formGroup.get('parrotCopyPet')?.value)!" width="24" height="24"
                    loading="lazy" decoding="async" alt="Parrot Copy" />
                <span class="selection-text">{{ formGroup.get('parrotCopyPet')?.value || 'Select Pet' }}</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </button>

            <!-- Beluga inside Parrot -->
            <div class="mt-2 ps-3 border-start" *ngIf="formGroup.get('parrotCopyPet')?.value === 'Beluga Whale'">
                <label class="swallowed-label">Then Beluga Swallow</label>
                <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
                    (click)="openSelectionDialog('swallowed-pet', undefined, 'parrot-beluga')">
                    <img *ngIf="getAbilityImagePath(formGroup.get('parrotCopyPetBelugaSwallowedPet')?.value)"
                        class="selection-icon"
                        [ngSrc]="getAbilityImagePath(formGroup.get('parrotCopyPetBelugaSwallowedPet')?.value)!" width="24"
                        height="24" loading="lazy" decoding="async" alt="Nested Beluga" />
                    <span class="selection-text">{{ formGroup.get('parrotCopyPetBelugaSwallowedPet')?.value || 'Select
                        Pet' }}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </button>
            </div>

            <!-- Abomination inside Parrot -->
            <div class="mt-2 ps-3 border-start" *ngIf="formGroup.get('parrotCopyPet')?.value === 'Abomination'">
                <div
                    *ngFor="let foo of [].constructor(getParrotCopyAbominationSlotCount()); index as i; trackBy: trackByIndex">
                    <label class="swallowed-label">{{ getParrotAbominationAbilityTitle(i) }}</label>
                    <button type="button" class="btn selection-btn w-100 d-flex align-items-center mb-2"
                        (click)="openSelectionDialog('ability', i+1, 'parrot-abomination')">
                        <span class="selection-icon-wrap"
                            *ngIf="getAbilityImagePath(formGroup.get('parrotCopyPetAbominationSwallowedPet' + (i+1))?.value) as parrotAbomAbilityIcon">
                            <img class="selection-icon" [ngSrc]="parrotAbomAbilityIcon" width="24" height="24"
                                loading="lazy" decoding="async" alt="Nested Abom Slot" />
                            <span class="selection-level-badge">{{ getParrotAbominationAbilityLevel(i) }}</span>
                        </span>
                        <span class="selection-text">{{ formGroup.get('parrotCopyPetAbominationSwallowedPet' +
                            (i+1))?.value || 'None' }}</span>
                        <i class="fas fa-chevron-down ms-auto"></i>
                    </button>
                    <div class="form-group small-w-input mb-2 ms-3"
                        *ngIf="shouldShowParrotCopyPetAbominationTimesHurt(i + 1)">
                        <label class="swallowed-label-small">Times Hurt</label>
                        <input class="form-control form-control-sm" type="number" min="0" max="99"
                            [formControlName]="'parrotCopyPetAbominationSwallowedPet' + (i+1) + 'TimesHurt'" />
                    </div>
                </div>
            </div>
        </div>

        <div *ngIf="pet?.name === 'Sarcastic Fringehead'">
            <label class="swallowed-label">Swallowed by Fringehead</label>
            <button type="button" class="btn selection-btn w-100 d-flex align-items-center"
                (click)="openSelectionDialog('swallowed-pet', undefined, 'pet')">
                <img *ngIf="getAbilityImagePath(formGroup.get('sarcasticFringeheadSwallowedPet')?.value)"
                    class="selection-icon"
                    [ngSrc]="getAbilityImagePath(formGroup.get('sarcasticFringeheadSwallowedPet')?.value)!" width="24"
                    height="24" loading="lazy" decoding="async" alt="Fringehead Swallowed" />
                <span class="selection-text">{{ formGroup.get('sarcasticFringeheadSwallowedPet')?.value || 'Select Pet'
                    }}</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </button>
        </div>
    </div>
</ng-container>
